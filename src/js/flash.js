import utils from './utils'export default class flash {  constructor(player) {    this.option = player.option;    this.el = player;    this.option.flash.flashVars.src = player.option.src;    this.FlashEvent = [      "rtmpConnection",      "defaultPlaybackRate",      "playbackRate",      "controls",      "defaultMuted"    ];    this.GetAndSet = [      "preload",      "autoplay",      "loop",      "volume",      "muted",      "rtmpStream",      "duration",      "mode",      "currentTime"    ];    this.getOnly = [      "autoplay",      "metadata",      "currentSrc",      "networkState",      "readyState",      "initialTime",      "startOffsetTime",      "paused",      "ended",      "videoWidth",      "videoHeight",      "buffered",      "bufferedBytesStart",      "bufferedBytesEnd",      "bytesTotal"    ];    this.startTimer = null;    let id = this.option.flash.attributes.id;    let swfNum = Math.random()      .toString()      .slice(-6);    this.swfId = `${id}_${swfNum}`;    let swfId = this.swfId;    window[swfId] = window[swfId] || {};    window[swfId].Flash = window[swfId].Flash || {};    window[swfId].Flash.onReady = this.onReady;    window[swfId].Flash.onEvent = this.onEvent;    window[swfId].Flash.onError = this.onError;    window[swfId].Flash._self = this;  }  get FlashDom() {    return this.flash_el;  }  createFlash() {    const flashVars = Object.assign(this.option.flash.flashVars, {      readyFunction: this.swfId + ".Flash.onReady",      eventProxyFunction: this.swfId + ".Flash.onEvent",      errorEventProxyFunction: this.swfId + ".Flash.onError",      autoplay: this.option.autoplay,      preload: this.option.preload,      loop: this.option.loop,      muted: this.option.muted,      volume: this.option.volume    });    const params = Object.assign(this.option.flash.params, {});    const attributes = Object.assign(this.option.flash.attributes, {      id: this.swfId,      name: this.swfId    });    const dom = this.getEmbedCode(      this.option.flash.swf,      flashVars,      params,      attributes    );    const video=this.el.tel.playerContainer.querySelector("video");    if (video){      delete video.parentElement.removeChild(video);    }    this.el.tel.playerContainer.innerHTML=dom;    return Promise.resolve(this.el.tel.playerContainer.childNodes[0])  }  getEmbedCode(swf, flashVars, params, attributes) {    const objTag = '<object type="application/x-shockwave-flash" ';    let flashVarsString = "";    let paramsString = "";    let attrsString = "";    if (flashVars) {      Object.getOwnPropertyNames(flashVars).forEach(function(key) {        flashVarsString += `${key}=${flashVars[key]}&amp;`;      });    }    params = Object.assign(params, {      movie: swf,      flashvars: flashVarsString    });    // Create param tags string    Object.getOwnPropertyNames(params).forEach(function(key) {      paramsString += `<param name="${key}" value="${params[key]}" />`;    });    attributes = Object.assign(attributes, {      data: swf    });    Object.getOwnPropertyNames(attributes).forEach(function(key) {      attrsString += `${key}="${attributes[key]}" `;    });    let dom=`${objTag}${attrsString}>${paramsString}</object> `     if (this.option.video.pic){       dom+=`<div class='player-poster' style="background-image: url(${this.option.video.pic});"></div>`     }    return dom;  }  embed() {     return new Promise((res,rej)=>{       this.createFlash().then((el)=>{         this.flash_el=el;         res()       });     })  }  play() {    return new Promise((res,rej)=>{       this.FlashDom.vjs_play();      res()    })  }  pause() {    this.FlashDom.vjs_pause();  }  src(src) {    if (src) {      this.FlashDom.vjs_src(src);    }  }  setSrc(src) {}  load() {    this.FlashDom.vjs_load();  }  resume() {    this.FlashDom.vjs_resume();  }  stop() {    this.FlashDom.vjs_stop();  }  autoplay(Autoplay) {    this.FlashDom.vjs_autoplay(Autoplay);  }  createSetter(type) {    Object.defineProperty(this, type, {      get: function() {        return this.FlashDom.vjs_getProperty(type);      },      set: function(val) {        this.FlashDom.vjs_setProperty(type, val);      }    });  }  createGetter(type) {    Object.defineProperty(this, type, {      configurable: true,      enumerable: true,      get: function() {        return this.FlashDom.vjs_getProperty(type);      }    });  }  initAttr() {    for (let i = 0; i < this.getOnly.length; i++) {      this.createGetter(this.getOnly[i]);    }    for (let i = 0; i < this.GetAndSet.length; i++) {      this.createSetter(this.GetAndSet[i]);    }  };  init(){    return new Promise((res,rej)=>{      if (this.isSupported()){        this.embed().then(()=>{           this.initAttr()           res()        });      }else {        rej()      }    })  }  on() {    this.el.event.on("playing", () => {      if (!this.startTimer) {        this.startTimer = setInterval(() => {          this.el.event.emit("timeupdate");        }, 1000);      }    });    this.el.event.on("pause", () => {      this.clearTimer();    });    this.el.event.on("ended", () => {      this.clearTimer();      this.player.bar.setPlayed(0);    });  }  onReady(swfID) {    this._self.el.event.emit("ready");    this._self.on();  }  onEvent(swfID, eventName) {    const args = Array.prototype.slice.call(arguments, 2);    this._self.el.event.emit(eventName, args);  }  onError(...arg) {    console.warn(...arg, "onError");  }  isSupported() {    let Flash = false;    if (this.el.browser.isMacOs) {      const swfflash = navigator.plugins["Shockwave Flash"];      if (swfflash) {        Flash = true;      }    } else {      try {        const swfflash = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");        if (swfflash) {          Flash = true;        }      } catch (e) {}    }    return Flash;  }  clearTimer(){    clearInterval(this.startTimer);    this.startTimer = null;  }   destroy() {    this.clearTimer();    this.pause();    this.stop();    this.el.event.off();    delete this.flash_el;    delete window[this.swfId];    delete this.swfId;    delete this.option ;    delete this.el;  }}